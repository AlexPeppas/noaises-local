/* ── Reset & Canvas ──────────────────────────────────────── */

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: transparent !important;
  background-color: transparent !important;
  font-family: system-ui, sans-serif;
}

/* ── Persona Container ──────────────────────────────────── */

.persona {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  filter: drop-shadow(0 8px 24px rgba(108, 92, 231, 0.35));
}

/* ── Lottie Blob ────────────────────────────────────────── */

.lottie-wrap {
  width: 200px;
  height: 200px;
  transition: filter 0.5s ease, transform 0.3s ease;
}

.lottie-wrap svg {
  display: block;
}

/* ── Particles (floating emojis) ─────────────────────────── */

.particles {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  z-index: 10;
  pointer-events: none;
}

.particle {
  position: absolute;
  left: var(--start-x, 0);
  top: var(--start-y, 0);
  animation: particle-float 1.8s ease-out forwards;
  opacity: 0;
  pointer-events: none;
  line-height: 1;
  will-change: transform, opacity;
}

@keyframes particle-float {
  0% {
    opacity: 0;
    transform: translate(0, 0) scale(0.3) rotate(0deg);
  }
  15% {
    opacity: 1;
    transform: translate(
      calc(var(--drift-x) * 0.15),
      calc(var(--drift-y) * 0.15)
    ) scale(1.1) rotate(calc(var(--rotate) * 0.3));
  }
  70% {
    opacity: 0.8;
    transform: translate(
      calc(var(--drift-x) * 0.7),
      calc(var(--drift-y) * 0.7)
    ) scale(1) rotate(calc(var(--rotate) * 0.7));
  }
  100% {
    opacity: 0;
    transform: translate(
      var(--drift-x),
      var(--drift-y)
    ) scale(0.6) rotate(var(--rotate));
  }
}

/* ── Glow Ring ──────────────────────────────────────────── */

.glow-ring {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 170px;
  height: 170px;
  border-radius: 50%;
  border: 2.5px solid transparent;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

@keyframes pulse-glow {
  0%, 100% { transform: translateX(-50%) scale(1); opacity: 0.5; border-width: 2.5px; }
  50%      { transform: translateX(-50%) scale(1.12); opacity: 1; border-width: 3.5px; }
}

/* ── Thought Bubble (thinking state) ────────────────────── */

.thought-bubble {
  position: absolute;
  top: 5px;
  right: -15px;
  display: flex;
  gap: 5px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.dot {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: #fdcb6e;
  box-shadow: 0 0 8px rgba(253, 203, 110, 0.5);
}

@keyframes bounce-dot {
  0%, 100% { transform: translateY(0) scale(1); }
  50%      { transform: translateY(-10px) scale(1.15); }
}

/* ── Zzz Bubble (sleeping state) ────────────────────────── */

.zzz-bubble {
  position: absolute;
  top: 0px;
  right: -12px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 2px;
  opacity: 0;
  transition: opacity 0.5s ease;
}

.zzz {
  font-family: system-ui, sans-serif;
  font-weight: 800;
  font-style: italic;
  color: #a29bfe;
  text-shadow: 0 0 8px rgba(162, 155, 254, 0.5);
  opacity: 0;
}

@keyframes zzz-float {
  0%   { opacity: 0; transform: translate(0, 0) scale(0.5); }
  20%  { opacity: 1; transform: translate(4px, -6px) scale(1); }
  80%  { opacity: 0.6; transform: translate(10px, -20px) scale(1.1); }
  100% { opacity: 0; transform: translate(14px, -30px) scale(0.7); }
}

/* ══════════════════════════════════════════════════════════
   STATE STYLES
   ══════════════════════════════════════════════════════════ */

/* ── Idle — gentle bob ──────────────────────────────────── */

@keyframes jelly-bob {
  0%   { transform: translateX(-50%) translateY(0); }
  25%  { transform: translateX(-50%) translateY(-6px); }
  50%  { transform: translateX(-50%) translateY(0); }
  75%  { transform: translateX(-50%) translateY(-3px); }
  100% { transform: translateX(-50%) translateY(0); }
}

.persona--idle {
  animation: jelly-bob 2.8s cubic-bezier(0.37, 0, 0.63, 1) infinite;
}

/* ── Listening — teal glow, pulse ───────────────────────── */

@keyframes listen-pulse {
  0%, 100% { transform: translateX(-50%) scale(1); }
  50%      { transform: translateX(-50%) scale(1.04); }
}

.persona--listening {
  animation: listen-pulse 1.4s ease-in-out infinite;
}

.persona--listening .lottie-wrap {
  filter: hue-rotate(-30deg) saturate(1.2) brightness(1.1);
}

.persona--listening .glow-ring {
  opacity: 1;
  border-color: #00cec9;
  box-shadow: 0 0 30px rgba(0, 206, 201, 0.4), inset 0 0 20px rgba(0, 206, 201, 0.1);
  animation: pulse-glow 1.4s ease-in-out infinite;
}

/* ── Thinking — warm glow, wobble, thought dots ─────────── */

@keyframes think-wobble {
  0%, 100% { transform: translateX(-50%) rotate(0deg); }
  20%      { transform: translateX(-50%) rotate(-3deg); }
  40%      { transform: translateX(-50%) rotate(2deg); }
  60%      { transform: translateX(-50%) rotate(-1deg); }
  80%      { transform: translateX(-50%) rotate(1.5deg); }
}

.persona--thinking {
  animation: think-wobble 2.5s ease-in-out infinite;
}

.persona--thinking .lottie-wrap {
  filter: hue-rotate(30deg) saturate(1.3) brightness(1.05);
}

.persona--thinking .thought-bubble {
  opacity: 1;
}

.persona--thinking .dot-1 { animation: bounce-dot 0.7s 0s infinite; }
.persona--thinking .dot-2 { animation: bounce-dot 0.7s 0.15s infinite; }
.persona--thinking .dot-3 { animation: bounce-dot 0.7s 0.3s infinite; }

/* ── Searching — blue glow, side-to-side scan ───────────── */

@keyframes search-scan {
  0%, 100% { transform: translateX(-50%) translateX(0); }
  25%      { transform: translateX(-50%) translateX(-6px); }
  50%      { transform: translateX(-50%) translateX(0); }
  75%      { transform: translateX(-50%) translateX(6px); }
}

.persona--searching {
  animation: search-scan 1.6s ease-in-out infinite;
}

.persona--searching .lottie-wrap {
  filter: hue-rotate(-60deg) saturate(1.4) brightness(1.1);
}

.persona--searching .glow-ring {
  opacity: 1;
  border-color: #74b9ff;
  box-shadow: 0 0 25px rgba(116, 185, 255, 0.3);
  animation: pulse-glow 2s ease-in-out infinite;
}

/* ── Speaking — energetic bounce ────────────────────────── */

@keyframes speak-bounce {
  0%, 100% { transform: translateX(-50%) scaleX(1) scaleY(1); }
  15%      { transform: translateX(-50%) scaleX(1.04) scaleY(0.96); }
  30%      { transform: translateX(-50%) scaleX(0.97) scaleY(1.03); }
  50%      { transform: translateX(-50%) scaleX(1.02) scaleY(0.98); }
  70%      { transform: translateX(-50%) scaleX(0.99) scaleY(1.01); }
}

.persona--speaking {
  animation: speak-bounce 0.9s ease-in-out infinite;
}

.persona--speaking .lottie-wrap {
  filter: brightness(1.1) saturate(1.1);
}

/* ── Sleeping — dim, slow, zzz ──────────────────────────── */

@keyframes sleep-breathe {
  0%, 100% { transform: translateX(-50%) scale(1); }
  50%      { transform: translateX(-50%) scale(0.97); }
}

.persona--sleeping {
  animation: sleep-breathe 3.5s ease-in-out infinite;
}

.persona--sleeping .lottie-wrap {
  filter: brightness(0.6) saturate(0.5) hue-rotate(10deg);
}

.persona--sleeping .zzz-bubble {
  opacity: 1;
}

.persona--sleeping .zzz-1 {
  font-size: 12px;
  animation: zzz-float 2.4s 0s ease-in-out infinite;
}

.persona--sleeping .zzz-2 {
  font-size: 16px;
  animation: zzz-float 2.4s 0.6s ease-in-out infinite;
}

.persona--sleeping .zzz-3 {
  font-size: 22px;
  animation: zzz-float 2.4s 1.2s ease-in-out infinite;
}

/* ── Seeing — teal/green glow, viewfinder, scan line ──── */

@keyframes focus-pulse {
  0%, 100% { transform: translateX(-50%) scale(1); }
  50%      { transform: translateX(-50%) scale(1.03); }
}

.persona--seeing {
  animation: focus-pulse 1.8s ease-in-out infinite;
}

.persona--seeing .lottie-wrap {
  filter: hue-rotate(-50deg) saturate(1.5) brightness(1.15);
}

.persona--seeing .glow-ring {
  opacity: 1;
  border-color: #00b894;
  box-shadow: 0 0 30px rgba(0, 184, 148, 0.4), inset 0 0 20px rgba(0, 184, 148, 0.1);
  animation: pulse-glow 1.8s ease-in-out infinite;
}

.persona--seeing .viewfinder { opacity: 1; }

/* ── Remembering — warm purple, cloud overlay ─────────── */

@keyframes gentle-sway {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  30%      { transform: translateX(-50%) translateY(-5px); }
  70%      { transform: translateX(-50%) translateY(3px); }
}

.persona--remembering {
  animation: gentle-sway 3s ease-in-out infinite;
}

.persona--remembering .lottie-wrap {
  filter: hue-rotate(20deg) saturate(1.2) brightness(1.05);
}

.persona--remembering .glow-ring {
  opacity: 1;
  border-color: #a29bfe;
  box-shadow: 0 0 25px rgba(162, 155, 254, 0.35);
  animation: pulse-glow 2.4s ease-in-out infinite;
}

.persona--remembering .memory-clouds { opacity: 1; }

/* ── Viewfinder Overlay ───────────────────────────────── */

.viewfinder {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 160px;
  height: 160px;
  transform: translate(-50%, -55%);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  z-index: 5;
}

.vf-corner {
  position: absolute;
  width: 20px;
  height: 20px;
  border-color: #00b894;
  border-style: solid;
  border-width: 0;
  animation: viewfinder-pulse 2s ease-in-out infinite;
}

.vf-tl { top: 0; left: 0; border-top-width: 2.5px; border-left-width: 2.5px; }
.vf-tr { top: 0; right: 0; border-top-width: 2.5px; border-right-width: 2.5px; }
.vf-bl { bottom: 0; left: 0; border-bottom-width: 2.5px; border-left-width: 2.5px; }
.vf-br { bottom: 0; right: 0; border-bottom-width: 2.5px; border-right-width: 2.5px; }

@keyframes viewfinder-pulse {
  0%, 100% { opacity: 0.6; }
  50%      { opacity: 1; }
}

.vf-scanline {
  position: absolute;
  left: 5%;
  width: 90%;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(0, 184, 148, 0.7), transparent);
  animation: scan-sweep 2.2s ease-in-out infinite;
}

@keyframes scan-sweep {
  0%   { top: 5%; opacity: 0; }
  10%  { opacity: 1; }
  90%  { opacity: 1; }
  100% { top: 95%; opacity: 0; }
}

/* ── Memory Clouds Overlay ────────────────────────────── */

.memory-clouds {
  position: absolute;
  top: -20px;
  left: 50%;
  transform: translateX(-50%);
  width: 180px;
  height: 60px;
  opacity: 0;
  transition: opacity 0.4s ease;
  pointer-events: none;
  z-index: 5;
}

.mem-cloud {
  position: absolute;
  border-radius: 50%;
  background: rgba(162, 155, 254, 0.25);
  box-shadow:
    15px 5px 0 rgba(162, 155, 254, 0.2),
    -10px 3px 0 rgba(162, 155, 254, 0.15);
  filter: blur(2px);
}

.mem-cloud-1 {
  width: 50px; height: 22px;
  top: 0; left: 20px;
  animation: cloud-breathe 3s 0s ease-in-out infinite;
}

.mem-cloud-2 {
  width: 40px; height: 18px;
  top: 10px; left: 80px;
  animation: cloud-breathe 3s 0.8s ease-in-out infinite;
}

.mem-cloud-3 {
  width: 45px; height: 20px;
  top: 25px; left: 50px;
  animation: cloud-breathe 3s 1.6s ease-in-out infinite;
}

@keyframes cloud-breathe {
  0%, 100% { transform: scale(1) translateY(0); opacity: 0.7; }
  50%      { transform: scale(1.15) translateY(-4px); opacity: 1; }
}

/* ── Particle Shapes (CSS-drawn) ──────────────────────── */

.particle--shape {
  position: absolute;
  left: var(--start-x, 0);
  top: var(--start-y, 0);
  animation: particle-float 1.8s ease-out forwards;
  opacity: 0;
  pointer-events: none;
  will-change: transform, opacity;
}

/* Hide overlays in wrong states */
.persona--sleeping .glow-ring { opacity: 0; }
.persona--sleeping .thought-bubble { opacity: 0; }
